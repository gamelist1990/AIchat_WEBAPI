<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <style>
        /* å…¨ä½“çš„ãªã‚¹ã‚¿ã‚¤ãƒ« */
        body {
      font-family: 'Consolas', monospace;
      margin: 0;
      padding: 0;
      color: #222;
      overflow: hidden;
    }

        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— */
        #desktop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: linear-gradient(to bottom, #007bff, #663399); /* ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      z-index: 1; /* #overlay ã‚ˆã‚Šã‚‚ä¸Šã«è¡¨ç¤º */
    }

    

        /* ã‚¿ã‚¹ã‚¯ãƒãƒ¼ */
        #taskbar {
      position: fixed; /* ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã‚’ç”»é¢ä¸‹éƒ¨ã«å›ºå®š */
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40px;
      background-color: #ccc;
      display: flex;
      align-items: center;
      padding: 0 10px;
      z-index: 2;
      display: none;
    }

        #taskbar .icon {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 20px;
        }

        /* ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .window {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: absolute;
            min-width: 300px;
            min-height: 200px;
            resize: both;
            overflow: hidden;
            z-index: 1;
        }

        /* ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ */
        .window-titlebar {
            background-color: #2196F3;
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .window-titlebar h2 {
            margin: 0;
            font-size: 14px;
        }

        .window-titlebar .controls button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-left: 8px;
        }

        /* ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .window-content {
            padding: 10px;
            height: calc(100% - 36px);
            overflow-y: auto;
        }

        /* ã‚¿ãƒ– */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 8px 12px;
            transition: background-color 0.3s;
            font-size: 13px;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 10px;
            border: 1px solid #ccc;
            border-top: none;
        }

        .tablinks {
            overflow-y: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .tablinks::-webkit-scrollbar {
            display: none;
        }

        /* ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ› */
        #console-output {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 8px;
            background-color: #000;
            color: #fff;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 6px;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ  */
        label {
            display: block;
            margin-bottom: 5px;
        }

        input[type="text"],
        input[type="password"],
        textarea {
            width: calc(100% - 12px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        /* ãƒœã‚¿ãƒ³ */
        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }

        .button:hover {
            background-color: #45a049;
        }

        .close-button {
            background-color: #f44336;
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }

        .close-button:hover {
            background-color: #d32f2f;
        }

        /* ãƒªã‚¹ãƒˆ */
        ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        li {
            margin-bottom: 5px;
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .error {
            color: red;
            margin-bottom: 10px;
        }

        /* ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  */
        #login-form {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        /* èƒŒæ™¯ã‚’æš—ãã™ã‚‹ */
        #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 0; /* #desktop ã‚ˆã‚Šã‚‚ä¸‹ã«è¡¨ç¤º */
    }

        /* iframeã®ã‚¹ã‚¿ã‚¤ãƒ« */
        iframe {
            width: 100%;
            height: calc(100% - 36px);
            border: none;
        }

        /* é›»å“ã‚¢ãƒ—ãƒªã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #calculator-window {
            width: 240px;
            height: 300px;
        }

        #calculator input[type="button"] {
            width: 40px;
            height: 40px;
            margin: 4px;
            font-size: 16px;
        }

        #calculator #display {
            width: calc(100% - 18px);
            height: 30px;
            margin: 4px;
            font-size: 18px;
        }

        /* æ™‚è¨ˆã‚¢ãƒ—ãƒªã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #clock-window {
            width: 300px;
            height: 100px;
        }

        #clock {
            width: 100%;
            height: 100%;
            font-size: 36px;
            text-align: center;
            line-height: 80px;
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #file-manager-window {
            width: 800px;
            height: 600px;
            top: 100px;
            left: 100px;
        }

        #file-manager-window .window-content {
            display: flex;
            flex-direction: column;
            height: calc(100% - 36px);
        }

        #file-manager-path-container {
            margin-bottom: 10px;
            padding: 8px 12px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }

        #file-manager-path {
            width: calc(100% - 70px);
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #file-manager-refresh {
            margin-left: 10px;
            padding: 5px 10px;
            background-color: #4CAF50;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        #file-manager-toolbar {
            margin-bottom: 10px;
            padding: 8px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
        }

        #file-manager-toolbar button {
            margin-right: 5px;
            padding: 6px 12px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #333;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        #file-manager-toolbar button:hover {
            background-color: #f0f0f0;
        }

        #file-manager-toolbar button img {
            vertical-align: middle;
            margin-right: 5px;
        }

        #file-manager-toolbar label {
            margin-right: 5px;
            padding: 6px 12px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #333;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        #file-manager-toolbar input[type="file"] {
            display: none;
        }

        #file-list-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            background-color: white;
        }

        #file-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            grid-gap: 10px;
            list-style: none;
            padding: 0;
        }

        #file-list li {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            background-color: white;
            transition: background-color 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #file-list li:hover {
            background-color: #f5f5f5;
        }

        #file-list li.folder {
            background-color: #f0f0f0;
        }

        #file-list li img {
            width: 64px;
            height: 64px;
            margin-bottom: 10px;
        }

        #file-list li.selected {
            background-color: #f0f0f0;
            border: 2px solid #007bff;
        }

        #file-manager-error {
            margin-top: 10px;
            color: red;
        }

        #file-view-window .window-content {
            display: flex;
            flex-direction: column;
            height: calc(100% - 36px);
        }

        #file-view-content {
            flex-grow: 1;
        }

        /* è¨­å®šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #settings-window {
            width: 500px;
            height: 400px;
        }

        #settings-window .window-content {
            padding: 20px;
        }

        #settings-window h3 {
            margin-top: 0;
        }

        #settings-window label {
            display: block;
            margin-bottom: 5px;
        }

        #settings-window input[type="text"],
        #settings-window input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        #settings-window .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }

        #settings-window .button:hover {
            background-color: #45a049;
        }

        /* ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®æ™‚è¨ˆã¨æ—¥ä»˜ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #taskbar-datetime {
            margin-left: auto;
            padding: 9px;
            color: black;
            width: 12%;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .window {
                min-width: 90%;
                min-height: 60%;
                top: 10%;
                left: 5%;
            }

            #taskbar {
                height: 60px;
            }

            #taskbar .icon {
                width: 40px;
                height: 40px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
<div id="taskbar">
    <div class="icon" onclick="openWindow('server-management')">ğŸ”§</div>
    <div class="icon" onclick="openWindow('web-browser-window')">ğŸŒ</div>
    <div class="icon" onclick="openWindow('notepad-window')">ğŸ“</div>
    <div class="icon" onclick="openWindow('resource-monitor-window')">ğŸ“Š</div>
    <div class="icon" onclick="openWindow('calculator-window')">ğŸ§®</div>
    <div class="icon" onclick="openWindow('clock-window')">â±ï¸</div>
    <div class="icon" onclick="openWindow('file-manager-window')">ğŸ“</div>
    <div class="icon" onclick="openWindow('settings-window')">âš™ï¸</div>
    <div id="taskbar-datetime"></div>
</div>

<div id="desktop">
    <div id="overlay"></div>

    <div id="login-form">
        <h2>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h2>
        <form id="login-form-form">
            <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
            <input type="password" id="password" name="password" required autocomplete="new-password">
            <button class="button" type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <div id="error-message" class="error"></div>
        </form>
    </div>

    <div id="server-management" class="window"
         style="display: none; width: 800px; height: 600px; top: 100px; left: 100px;">
        <div class="window-titlebar">
            <h2>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('server-management')">X</button>
            </div>
        </div>
        <div class="window-content">
            <div class="tab">
                <button class="tablinks" onclick="openTab(event, 'server-status')">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</button>
                <button class="tablinks" onclick="openTab(event, 'console')">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</button>
                <button class="tablinks" onclick="openTab(event, 'ban-management')">BANç®¡ç†</button>
                <button class="tablinks" onclick="openTab(event, 'file-management')">ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</button>
            </div>

            <div id="server-status" class="tabcontent">
                <h3>ã‚µãƒ¼ãƒãƒ¼æƒ…å ±</h3>
                <div id="server-status-content"></div>
                <form id="stop-server-form">
                    <button class="button" type="submit">ã‚µãƒ¼ãƒãƒ¼åœæ­¢</button>
                </form>
                <br>
                <form id="start-server-form">
                    <button class="button" type="submit">ã‚µãƒ¼ãƒãƒ¼èµ·å‹•</button>
                </form>
            </div>

            <div id="console" class="tabcontent">
                <h3>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</h3>
                <pre id="console-output"></pre>
                <br>
                <button class="button" onclick="getConsoleLog()">æ›´æ–°</button>
                <br>
            </div>

            <div id="ban-management" class="tabcontent">
                <h3>BANç®¡ç†</h3>
                <p>ç¾åœ¨ã®BANäººæ•°: <span id="banned-count">0</span></p>
                <table id="ban-history">
                    <thead>
                    <tr>
                        <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</th>
                        <th>BANæ™‚é–“</th>
                        <th>è§£é™¤</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <button class="button" onclick="updateBanHistory()">BANãƒªã‚¹ãƒˆæ›´æ–°</button>
                <form id="unban-form">
                    <label for="user-id">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</label>
                    <input type="text" id="user-id" name="user_id" required>
                    <button class="button" type="submit">BANè§£é™¤</button>
                </form>
            </div>

            <div id="file-management" class="tabcontent">
                <h3>ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</h3>
                <div class="management-section">
                    <form id="rename-form">
                        <label for="old-name">æ—§ãƒ•ã‚¡ã‚¤ãƒ«å:</label>
                        <input type="text" id="old-name" name="old-name" required>
                        <label for="new-name">æ–°ãƒ•ã‚¡ã‚¤ãƒ«å:</label>
                        <input type="text" id="new-name" name="new-name" required>
                        <button class="button" type="submit">åå‰å¤‰æ›´</button>
                    </form>
                    <div id="rename-result"></div>
                </div>
                <div class="management-section">
                    <form id="show-form">
                        <label for="show-file">ãƒ•ã‚¡ã‚¤ãƒ«å(æ‹¡å¼µå­å«ã‚€):</label>
                        <input type="text" id="show-file" name="file_name" required>
                        <button class="button" type="submit">è¡¨ç¤º</button>
                    </form>
                    <pre id="show-result"
                         style="height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-top: 10px;"></pre>
                </div>
                <div class="management-section">
                    <form id="update-json-form">
                        <label for="json-file-path">ãƒ•ã‚¡ã‚¤ãƒ«å(æ‹¡å¼µå­å«ã‚€):</label>
                        <input type="text" id="json-file-path" name="file_path" required>
                        <label for="json-data">ãƒ‡ãƒ¼ã‚¿:</label>
                        <textarea id="json-data" name="data" rows="5" required></textarea>
                        <button class="button" type="submit">ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>
                    </form>
                    <br>
                    <div id="update-json-result"></div>
                </div>
                <div class="management-section">
                    <form id="execute-command-form">
                        <label for="command-to-execute">ã‚³ãƒãƒ³ãƒ‰:</label>
                        <input type="text" id="command-to-execute" name="command_to_execute" required>
                        <button class="button" type="submit">å®Ÿè¡Œ</button>
                    </form>
                    <div id="command-result"></div>
                    <br>
                </div>
            </div>
        </div>
    </div>

    <div id="web-browser-window" class="window"
         style="display: none; width: 800px; height: 600px; top: 150px; left: 150px;">
        <div class="window-titlebar">
            <h2>Webãƒ–ãƒ©ã‚¦ã‚¶</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('web-browser-window')">X</button>
            </div>
        </div>
        <div class="window-content">
            <iframe id="web-browser-iframe" src="https://gamelist1990.github.io/gamelist1990/page/"></iframe>
        </div>
    </div>

    <div id="resource-monitor-window" class="window"
         style="display: none; width: 200px; height: 300px; top: 250px; left: 250px;">
        <div class="window-titlebar">
            <h2>ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒ¼</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('resource-monitor-window')">X</button>
            </div>
        </div>
        <div class="window-content">
            <div id="cpu-usage" style="width: 100%; height: 100px; margin-bottom: 20px;"></div>
            <div id="memory-usage" style="width: 100%; height: 100px;"></div>
        </div>
    </div>

    <div id="calculator-window" class="window"
         style="display: none; width: 300px; height: 400px; top: 100px; left: 100px;">
        <div class="window-titlebar">
            <h2>é›»å“</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('calculator-window')">X</button>
            </div>
        </div>
        <div class="window-content">
            <div id="calculator">
                <input type="text" id="display" readonly>
                <input type="button" value="7" onclick="inputDigit('7')">
                <input type="button" value="8" onclick="inputDigit('8')">
                <input type="button" value="9" onclick="inputDigit('9')">
                <input type="button" value="/" onclick="inputOperator('/')">
                <br>
                <input type="button" value="4" onclick="inputDigit('4')">
                <input type="button" value="5" onclick="inputDigit('5')">
                <input type="button" value="6" onclick="inputDigit('6')">
                <input type="button" value="*" onclick="inputOperator('*')">
                <br>
                <input type="button" value="1" onclick="inputDigit('1')">
                <input type="button" value="2" onclick="inputDigit('2')">
                <input type="button" value="3" onclick="inputDigit('3')">
                <input type="button" value="-" onclick="inputOperator('-')">
                <br>
                <input type="button" value="0" onclick="inputDigit('0')">
                <input type="button" value="." onclick="inputDecimal('.')">
                <input type="button" value="C" onclick="clearDisplay()">
                <input type="button" value="+" onclick="inputOperator('+')">
                <br>
                <input type="button" value="=" onclick="calculate()" style="width: 210px;">
            </div>
        </div>
    </div>

    <div id="clock-window" class="window"
         style="display: none; width: 300px; height: 100px; top: 200px; left: 200px;">
        <div class="window-titlebar">
            <h2>æ™‚è¨ˆ</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('clock-window')">X</button>
            </div>
        </div>
        <div class="window-content">
            <div id="clock"></div>
        </div>
    </div>
    <div id="notepad-window" class="window"
         style="display: none; width: 600px; height: 400px; top: 200px; left: 200px;">
        <div class="window-titlebar">
            <h2>ãƒ¡ãƒ¢å¸³</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('notepad-window')">X</button>
            </div>
        </div>
        <div class="window-content" style="padding-bottom: 40px;">
            <textarea id="notepad-textarea" style="width: 100%; height: calc(100% - 35px);"></textarea>
            <br>
            <button class="button" onclick="saveNotepad()" style="position: absolute; bottom: 10px; left: 10px;">ä¿å­˜
            </button>
        </div>
    </div>

    <div id="file-manager-window" class="window" style="display: none;">
        <div class="window-titlebar">
            <h2>ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('file-manager-window')">X</button>
            </div>
        </div>
        <div class="window-content">
            <div id="file-manager-path-container">
                <input type="text" id="file-manager-path" value="/" onkeydown="handlePathInput(event)">
                <button id="file-manager-refresh" onclick="getFileList()">æ›´æ–°</button>
            </div>
            <div id="file-manager-toolbar">
                <button onclick="createFolder()">
                    ğŸ“ æ–°è¦ãƒ•ã‚©ãƒ«ãƒ€
                </button>
                <label for="upload-file">
                    â¬†ï¸ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                </label>
                <input type="file" id="upload-file" onchange="uploadFile()">
                <button id="delete-selected-button" onclick="deleteSelectedFile()" disabled>
                    ğŸ—‘ï¸ å‰Šé™¤
                </button>
                <button id="download-selected-button" onclick="downloadSelectedFile()" disabled>
                    â¬‡ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </button>
                <button id="rename-selected-button" onclick="renameSelectedFile()" disabled>
                    âœï¸ åå‰å¤‰æ›´
                </button>
                <button id="move-selected-button" onclick="initiateMove()" disabled>
                    â¡ï¸ ç§»å‹•
                </button>
            </div>
            <div id="file-list-container">
                <ul id="file-list"></ul>
            </div>
            <div id="file-manager-error" class="error"></div>
        </div>
    </div>
    <div id="file-view-window" class="window"
         style="display: none; width: 800px; height: 600px; top: 100px; left: 100px;">
        <div class="window-titlebar">
            <h2 id="file-view-title">ãƒ•ã‚¡ã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚¢</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('file-view-window')">X</button>
            </div>
        </div>
        <div class="window-content" style="padding-bottom: 40px;">
            <textarea id="file-view-content" style="width: 100%; height: calc(100% - 75px);"></textarea>
            <br>
            <button class="button" onclick="saveFileContent()" style="position: absolute; bottom: 10px; left: 10px;">
                ä¿å­˜
            </button>
            <button class="button" onclick="exportFileContent()" style="position: absolute; bottom: 10px; left: 100px;">
                ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            </button>
        </div>
    </div>

    <div id="settings-window" class="window"
         style="display: none; width: 600px; height: 400px; top: 200px; left: 200px;">
        <div class="window-titlebar">
            <h2>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('settings-window')">X</button>
            </div>
        </div>
        <div class="window-content">
            <h3>ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®èƒŒæ™¯ç”»åƒ</h3>
            <label for="background-image-url">ç”»åƒURL:</label>
            <input type="text" id="background-image-url">

            <h3>è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³</h3>
            <input type="checkbox" id="auto-login">
            <label for="auto-login">æ¬¡å›ã‹ã‚‰è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹</label>

            <h3>è§£åƒåº¦ã®è‡ªå‹•èª¿ç¯€</h3>
            <input type="checkbox" id="auto-resolution">
            <label for="auto-resolution">è‡ªå‹•çš„ã«è§£åƒåº¦ã‚’èª¿ç¯€ã™ã‚‹</label>
            <button class="button" onclick="saveSettings()">è¨­å®šã®ä¿å­˜</button>
            <br>
            <br />
            <br>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded',async () => {
        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('login-form-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            await login();
        });

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’å‹•ã‹ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹é …ç›®
        dragElement(document.getElementById("server-management"));
        dragElement(document.getElementById("web-browser-window"));
        dragElement(document.getElementById("notepad-window"));
        dragElement(document.getElementById("resource-monitor-window"));
        dragElement(document.getElementById("calculator-window"));
        dragElement(document.getElementById("clock-window"));
        dragElement(document.getElementById("file-manager-window"));
        dragElement(document.getElementById("file-view-window"));
        dragElement(document.getElementById("settings-window"));

     

        // æœ€åˆã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¿ãƒ–ã‚’é–‹ã
        document.querySelector('#server-management .tab button:first-child').click();

        
        // è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
  if (localStorage.getItem('autoLogin') === 'true') {
    const savedPassword = localStorage.getItem('savedPassword');
    if (savedPassword) {
      document.getElementById('password').value = savedPassword;
      await login(); // await ã‚’è¿½åŠ 
    }
  }

    });

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let globalPassword = "";
    let currentPath = "";
    let selectedFile = null; // é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«è¦ç´ ã‚’ä¿æŒã™ã‚‹å¤‰æ•°


    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    async function login() {
        const passwordInput = document.getElementById('password');
        const password = passwordInput.value;

        try { 
                       const response = await fetch('/antibot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `password=${password}`
            });

            if (response.ok) {
                // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('overlay').style.display = 'none';
                document.getElementById('server-management').style.display = 'block';
                document.getElementById('taskbar').style.display = 'flex';

                // Pusher ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
                const pusher = new Pusher('4cbc3c15bfd521142b7a', {
                    cluster: 'ap3',
                    authEndpoint: '/pusher/auth' // èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ 
                });

                // privateãƒãƒ£ãƒ³ãƒãƒ«ã‚’è³¼èª­
                const channel = pusher.subscribe('private-my-channel');

                // console_log ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­
                channel.bind('console_log', function (data) {
                    const consoleOutput = document.getElementById('console-output');
                    const logMessage = document.createElement('p');
                    logMessage.textContent = data.message;
                    consoleOutput.appendChild(logMessage);
                });

                // server_status ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­
                channel.bind('server_status', function (data) {
                    updateServerStatus(data.data);
                });

                // resources ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­
                channel.bind('resources', function (data) {
                    updateResourceMonitor(data);
                });

                // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã¨ãƒ—ãƒ­ã‚»ã‚¹æƒ…å ±ã‚’å–å¾—
                globalPassword = document.getElementById('password').value; // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜

                getServerStatus();
                getConsoleLog(); // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’å–å¾—
                updateBanHistory(); //BANè€…ã‚’æ¤œçŸ¥
                getFileList(); //ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
                applySettings();
                loadSettings();

                // è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ãŒæœ‰åŠ¹ã§ã‚ã‚Œã°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜
                if (document.getElementById('auto-login').checked) {
                    localStorage.setItem('autoLogin', 'true');
                    localStorage.setItem('savedPassword', password);
                } else {
                    localStorage.setItem('autoLogin', 'false');
                    localStorage.removeItem('savedPassword');
                }
            } else {
                // ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—æ™‚ã®å‡¦ç†
                if (localStorage.getItem('autoLogin') === 'true') {
                    // è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ãŒæœ‰åŠ¹ã ãŒå¤±æ•—ã—ãŸå ´åˆã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¦å†å…¥åŠ›ã‚’ä¿ƒã™
                    localStorage.removeItem('savedPassword');
                    alert("è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                }
                document.getElementById('error-message').textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚';
            }
        } catch (error) {
            console.error(error);
            document.getElementById('error-message').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }
    }

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•å¯èƒ½ã«ã™ã‚‹é–¢æ•°
    function dragElement(elmnt) {
        let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
        let isDragging = false; // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã‹ã©ã†ã‹ã‚’ç¤ºã™ãƒ•ãƒ©ã‚°

        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸¡æ–¹ã«å¯¾å¿œ
        elmnt.querySelector('.window-titlebar').addEventListener('mousedown', dragMouseDown);
        elmnt.querySelector('.window-titlebar').addEventListener('touchstart', dragMouseDown);

        function dragMouseDown(e) {
            e = e || window.event;
            e.preventDefault();

            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€æœ€åˆã®ã‚¿ãƒƒãƒãƒã‚¤ãƒ³ãƒˆã®åº§æ¨™ã‚’å–å¾—
            if (e.type === 'touchstart') {
                pos3 = e.touches[0].clientX;
                pos4 = e.touches[0].clientY;
            } else {
                // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€é€šå¸¸ã®åº§æ¨™ã‚’å–å¾—
                pos3 = e.clientX;
                pos4 = e.clientY;
            }

            isDragging = true; // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹

            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸¡æ–¹ã«å¯¾å¿œ
            document.addEventListener('mouseup', closeDragElement);
            document.addEventListener('touchend', closeDragElement);
            document.addEventListener('mousemove', elementDrag);
            document.addEventListener('touchmove', elementDrag);
        }

        function elementDrag(e) {
            if (!isDragging) return; // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã§ãªã„å ´åˆã¯å‡¦ç†ã—ãªã„

            e = e || window.event;
            e.preventDefault();

            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€æœ€åˆã®ã‚¿ãƒƒãƒãƒã‚¤ãƒ³ãƒˆã®åº§æ¨™ã‚’å–å¾—
            if (e.type === 'touchmove') {
                pos1 = pos3 - e.touches[0].clientX;
                pos2 = pos4 - e.touches[0].clientY;
                pos3 = e.touches[0].clientX;
                pos4 = e.touches[0].clientY;
            } else {
                // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€é€šå¸¸ã®åº§æ¨™ã‚’å–å¾—
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
            }

            // è¦ç´ ã®ä½ç½®ã‚’æ›´æ–°
            elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
            elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
        }

        function closeDragElement() {
            isDragging = false; // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
            document.removeEventListener('mouseup', closeDragElement);
            document.removeEventListener('touchend', closeDragElement);
            document.removeEventListener('mousemove', elementDrag);
            document.removeEventListener('touchmove', elementDrag);
        }
    }


    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãé–¢æ•°
    function openWindow(windowId) {
        const appWindow = document.getElementById(windowId); // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®è¦ç´ 
        appWindow.style.display = 'block';

    }

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹é–¢æ•°
    function closeWindow(windowId) {
        document.getElementById(windowId).style.display = 'none';
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }


    //ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼é–¢æ•°
    async function fileManagerRequest(action, data = {}) {
        const response = await fetch('/admin/file_manager', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Cache-Control': 'no-cache'
            },
            body: JSON.stringify({
                password: globalPassword,
                action: action,
                path: currentPath, // currentPath ã‚’ä½¿ç”¨ã™ã‚‹
                ...data
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        return await response.json();
    }

    async function getFileList() {
        try {
            const data = await fileManagerRequest("list");
            displayFileList(data.files);
            document.getElementById('file-manager-error').textContent = "";
            currentPath = document.getElementById('file-manager-path').value; // ãƒ‘ã‚¹ã‚’æ›´æ–°
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    // ãƒ‘ã‚¹å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‡¦ç†
    function handlePathInput(event) {
    if (event.key === "Enter") {
        // å…¥åŠ›ã•ã‚ŒãŸãƒ‘ã‚¹ã‚’å–å¾—
        currentPath = document.getElementById('file-manager-path').value;
        getFileList();
    }
}
    // ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
    async function deleteFile(fileName) {
        if (!confirm(`"${fileName}" ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;

        try {
            await fileManagerRequest("delete", {name: fileName});
            getFileList(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }
    // ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    async function uploadFile() {
        const fileInput = document.getElementById('upload-file');
        const file = fileInput.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append('file', file);
        formData.append('password', globalPassword);
        formData.append('path', currentPath);

        try {
            const response = await fetch('/admin/upload', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                getFileList(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
            } else {
                console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
            }
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    async function downloadFile(fileName) {
        try {
            const response = await fetch(`/admin/download?password=${globalPassword}&path=${currentPath}/${fileName}`);
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                a.remove();
            } else {
                console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
            }
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    async function createFolder() {
        const folderName = prompt("æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", "æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€");
        if (folderName === null || folderName.trim() === "") return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¾ãŸã¯ç©ºæ–‡å­—åˆ—ã®å ´åˆã¯å‡¦ç†ã‚’ä¸­æ–­

        try {
            await fileManagerRequest("create_folder", {name: folderName});
            getFileList(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        } catch (error) {
            console.error('ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã®è¡¨ç¤º
    function displayFileList(files) {
        selectedFile = null; // displayFileList ã®æœ€åˆã« selectedFile ã‚’ null ã«åˆæœŸåŒ–
        const fileList = document.getElementById('file-list');
        fileList.innerHTML = '';

        for (const file of files) {
            const li = document.createElement('li');
            // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®è¦ç´ ã‚’è¿½åŠ 
            const fileNameSpan = document.createElement('span');
            fileNameSpan.textContent = file.name;
            fileNameSpan.classList.add('file-name'); // ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

            if (file.isDirectory) {
                li.classList.add("folder");
                li.innerHTML = ' ';
                li.appendChild(fileNameSpan); // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¡¨ç¤º
                li.addEventListener('click', () => {
                // ãƒ‘ã‚¹åŒºåˆ‡ã‚Šæ–‡å­—ã‚’é©åˆ‡ã«è¿½åŠ 
                currentPath = currentPath.endsWith('/') ? currentPath + file.name : currentPath + '/' + file.name;
                document.getElementById('file-manager-path').value = currentPath;
                getFileList();
            });
            } else {
                // ãƒ•ã‚¡ã‚¤ãƒ«åã¨ã‚µã‚¤ã‚ºã‚’è¡¨ç¤º
                li.innerHTML = ' ';

                // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¡¨ç¤ºã™ã‚‹è¦ç´ ã‚’è¨­å®š
                fileNameSpan.textContent = file.name;
                fileNameSpan.dataset.filename = file.name; // data-filename å±æ€§ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¨­å®š
                li.appendChild(fileNameSpan);

                const fileSizeDiv = document.createElement('div');
                fileSizeDiv.textContent = `(${file.size} bytes)`;
                fileSizeDiv.style.fontSize = '12px';
                fileSizeDiv.style.color = 'gray';
                li.appendChild(fileSizeDiv);
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ä¿å­˜
                li.dataset.size = file.size;
            }

            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ãƒãƒ¼ã‚¯å‡¦ç†ã‚’è¡Œã†
            li.addEventListener('click', (event) => {
                // æ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°ãƒãƒ¼ã‚¯ã‚’å¤–ã™
                if (selectedFile && selectedFile !== li) {
                    selectedFile.classList.remove('selected');
                }

                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
                if (li.classList.contains('selected')) {
                    li.classList.remove('selected');
                    selectedFile = null;
                } else {
                    li.classList.add('selected');
                    selectedFile = li;
                }
                updateToolbarState(); // ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            });

            // ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚’é–‹ã
            li.addEventListener('dblclick', () => {
                const fileNameSpan = event.currentTarget.querySelector('.file-name');
                const fileName = fileNameSpan.dataset.filename;
                viewFileContent(file.name);
            });

            fileList.appendChild(li);
        }
        updateToolbarState(); // åˆæœŸçŠ¶æ…‹ã§ã¯ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹ã«ã™ã‚‹
    }

    function updateToolbarState() {
        const deleteButton = document.getElementById('delete-selected-button');
        const downloadButton = document.getElementById('download-selected-button');
        const renameButton = document.getElementById('rename-selected-button');
        const moveButton = document.getElementById('move-selected-button');


        if (selectedFile) {
            deleteButton.disabled = false;
            downloadButton.disabled = false;
            renameButton.disabled = false;
            moveButton.disabled = !selectedFile;
        } else {
            deleteButton.disabled = true;
            downloadButton.disabled = true;
            renameButton.disabled = true;
        }
    }


    async function deleteSelectedFile() {
        if (!selectedFile) return;
        const fileNameSpan = selectedFile.querySelector('.file-name'); // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹spanè¦ç´ ã‚’å–å¾—
        const fileName = fileNameSpan.dataset.filename; // data-filename å±æ€§ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—

        if (!confirm(`"${fileName}" ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;

        try {
            await fileManagerRequest("delete", {name: fileName});
            getFileList(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
            selectedFile = null; // ãƒ•ã‚¡ã‚¤ãƒ«ã®é¸æŠã‚’è§£é™¤
            updateToolbarState(); // ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹ã«ã™ã‚‹
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    async function downloadSelectedFile() {
        if (!selectedFile) return;
        const fileNameSpan = selectedFile.querySelector('.file-name');
        const fileName = fileNameSpan.dataset.filename;

        try {
            const response = await fetch(`/admin/download?password=${globalPassword}&path=${currentPath}/${fileName}`);
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                a.remove();
            } else {
                console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
            }
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    // é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰å¤‰æ›´ (è¿½åŠ )
    async function renameSelectedFile() {
        if (!selectedFile) return;
        const fileNameSpan = selectedFile.querySelector('.file-name');
        const oldName = fileNameSpan.dataset.filename;
        const newName = prompt("æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", oldName);

        if (newName === null || newName.trim() === "") return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¾ãŸã¯ç©ºæ–‡å­—åˆ—ã®å ´åˆã¯å‡¦ç†ã‚’ä¸­æ–­

        try {
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¡¨ç¤ºã‚’ä¸€æ™‚çš„ã«å‰Šé™¤
            selectedFile.innerHTML = ' ' + oldName;

            await fileManagerRequest("rename", {old_name: oldName, new_name: newName});
            getFileList(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°

            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¡¨ç¤ºã‚’å¾©å…ƒ
            selectedFile.innerHTML = ' ' + newName + `<div style="font-size: 12px; color: gray;">${selectedFile.dataset.size} bytes</div>`;

            selectedFile = null; // ãƒ•ã‚¡ã‚¤ãƒ«ã®é¸æŠã‚’è§£é™¤
            updateToolbarState(); // ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹ã«ã™ã‚‹
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    async function viewFileContent(fileName) {
        try {
            const response = await fetch(`/admin/download?password=${globalPassword}&path=${currentPath}/${fileName}`, {
                headers: {  // headers ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
                    'Cache-Control': 'no-cache' // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹ã«ã™ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼
                }
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const content = await response.text({encoding: 'utf-8'});

            // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«å†…å®¹ã‚’è¡¨ç¤º
            document.getElementById('file-view-title').textContent = fileName;
            document.getElementById('file-view-content').value = content;
            openWindow('file-view-window');

        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    async function saveFileContent() {
        const fileName = document.getElementById('file-view-title').textContent;
        const content = document.getElementById('file-view-content').value;

        try {
            const response = await fetch('/admin/file_manager', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    password: globalPassword,
                    action: 'save',
                    path: currentPath,
                    name: fileName,
                    content: content
                })
            });

            if (response.ok) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚');
                getFileList();
            } else {
                const errorData = await response.json();
                alert(`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${errorData.error}`);
            }
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
            alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
        }
    }

    function exportFileContent() {
        const fileName = document.getElementById('file-view-title').textContent;
        const content = document.getElementById('file-view-content').value;

        // Blobã‚’ä½œæˆ
        const blob = new Blob([content], {type: 'text/plain'});

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName;

        // ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // ç§»å‹•é–‹å§‹
    let fileToMove = null;
    let originalPath = null;

    function initiateMove() {
        if (!selectedFile) return;

        fileToMove = selectedFile.querySelector('.file-name').dataset.filename;
        originalPath = currentPath;

        const moveButton = document.getElementById('move-selected-button');
        moveButton.textContent = "ç§»å‹•å®Œäº†";
        moveButton.onclick = completeMove;
    }

    // ç§»å‹•å®Œäº†
    async function completeMove() {
        try {
            const response = await fileManagerRequest("move", {
                old_path: `${originalPath}/${fileToMove}`,
                new_path: `${currentPath}/${fileToMove}`
            });

            // ç§»å‹•ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
            const moveButton = document.getElementById('move-selected-button');
            moveButton.textContent = " ç§»å‹•";
            moveButton.onclick = initiateMove;

            if (response.message) {
                getFileList(); // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                fileToMove = null;
                originalPath = null;
            } else {
                console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ç§»å‹•ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', response.error);
                document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
            }
        } catch (error) {
            console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã®ç§»å‹•ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', error);
            document.getElementById('file-manager-error').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
    }

    // ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã®å–å¾—
    function getServerStatus() {
        fetch('/admin/status', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({password: document.getElementById('password').value})
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã‚’æ›´æ–°
                updateServerStatus(data.data);
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
            });
    }

    // ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã®æ›´æ–°
    function updateServerStatus(data) {
        // 'server-status-content' ãªã©ã®è¦ç´ ã«ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã‚’å‡ºåŠ›
        let output = '';
        for (const key in data) {
            output += `<p>${key}: ${data[key]}</p>`;
        }
        document.getElementById('server-status-content').innerHTML = output;
    }

    // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    async function getConsoleLog() {
        const password = document.getElementById('password').value; // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—

        try {
            const response = await fetch('/admin/console_log', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({password: password})
            });

            if (response.ok) {
                const data = await response.json();
                updateConsoleLog(data.console_log); // data.console_log ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ãŒå…¥ã£ã¦ã„ã‚‹
            } else {
                console.error('ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }

        } catch (error) {
            console.error('ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
        }
    }

    // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®æ›´æ–°
    function updateConsoleLog(data) {
        // 'console-output' è¦ç´ ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’å‡ºåŠ›
        document.getElementById('console-output').textContent = data.join(''); // data.join('') ã§ãƒªã‚¹ãƒˆã‚’æ–‡å­—åˆ—ã«å¤‰æ›
    }

    async function updateBanHistory() {
        try {
            const response = await fetch('/antibot/history');
            const data = await response.json();

            document.getElementById('banned-count').textContent = data.bannedCount;
            const banHistoryTable = document.getElementById('ban-history').querySelector('tbody');

            // æ—¢å­˜ã®è¡Œã‚’å‰Šé™¤
            while (banHistoryTable.firstChild) {
                banHistoryTable.removeChild(banHistoryTable.firstChild);
            }

            data.banHistory.forEach(ban => {
                const row = banHistoryTable.insertRow();
                row.insertCell().textContent = ban.user_id;
                row.insertCell().textContent = ban.ban_time;

                const unbanButton = document.createElement('button');
                unbanButton.textContent = 'è§£é™¤';
                unbanButton.classList.add('button');
                unbanButton.addEventListener('click', () => {
                    unbanUser(ban.user_id);
                });
                row.insertCell().appendChild(unbanButton);
            });
        } catch (error) {
            console.error(error);
        }
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®BANè§£é™¤
    async function unbanUser(userId) {
        try {
            const response = await fetch('/antibot/unban', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({user_id: userId}) // JSON ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ user_id ã‚’é€ä¿¡
            });

            if (response.ok) {
                // BANè§£é™¤å¾Œã«BANå±¥æ­´ã‚’æ›´æ–°
                updateBanHistory();
            } else {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®BANè§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        } catch (error) {
            console.error(error);
        }
    }


    // ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ã®åå‰å¤‰æ›´
    document.getElementById('rename-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        const oldName = document.getElementById('old-name').value;
        const newName = document.getElementById('new-name').value;

        try {
            const response = await fetch('/admin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    rename: {old_name: oldName, new_name: newName},
                    password: document.getElementById('password').value
                })
            });

            if (response.ok) {
                const data = await response.json();
                document.getElementById('rename-result').textContent = data.message;
            } else {
                document.getElementById('rename-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
            }
        } catch (error) {
            console.error(error);
            document.getElementById('rename-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡¨ç¤º
    document.getElementById('show-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        const showFilename = document.getElementById('show-file').value;
        const password = document.getElementById('password').value;

        try {
            const response = await fetch('/admin/showfile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({file_name: showFilename, password: password})
            });

            if (response.ok) {
                const fileContent = await response.text();
                const formattedContent = fileContent.replace(/\n/g, '<br>'); // æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ <br> ã‚¿ã‚°ã«å¤‰æ›
                document.getElementById('show-result').innerHTML = formattedContent; // innerHTML ã‚’ä½¿ç”¨ã—ã¦ HTML ã¨ã—ã¦è¨­å®š
            } else {
                const errorData = await response.json();
                document.getElementById('show-result').textContent = errorData.error;
            }

        } catch (error) {
            console.error(error);
            document.getElementById('show-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }
    });

    // BANè§£é™¤ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
    document.getElementById('unban-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        const userId = document.getElementById('user-id').value;
        await unbanUser(userId);
    });

    // JSONæ›´æ–°ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
    document.getElementById('update-json-form').addEventListener('submit', async (event) => {
        event.preventDefault();

        const filePath = document.getElementById('json-file-path').value;
        const jsonData = document.getElementById('json-data').value;
        const password = document.getElementById('password').value;

        try {
            const response = await fetch('/admin/update_json', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    password: password,
                    file_path: filePath, // file_path ã‚’è¿½åŠ 
                    data: JSON.parse(jsonData) // data ã‚’è¿½åŠ 
                })
            });

            if (response.ok) {
                const data = await response.json();
                document.getElementById('update-json-result').textContent = data.message;
            } else {
                document.getElementById('update-json-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
            }
        } catch (error) {
            console.error(error);
            document.getElementById('update-json-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }
    });

    // ã‚µãƒ¼ãƒãƒ¼åœæ­¢
    document.getElementById('stop-server-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        try {
            const response = await fetch('/admin/update_server_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `status=stop&password=${document.getElementById('password').value}`
            });
            if (response.ok) {
                alert("ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã—ã¾ã—ãŸã€‚");
                getServerStatus(); // WebSocket ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±ã‚’æ›´æ–°
            } else {
                alert("ã‚µãƒ¼ãƒãƒ¼ã®åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            }
        } catch (error) {
            console.error(error);
            alert("ã‚µãƒ¼ãƒãƒ¼ã®åœæ­¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
        }
    });

    // ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    document.getElementById('start-server-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        try {
            const response = await fetch('/admin/update_server_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `status=start&password=${document.getElementById('password').value}`
            });
            if (response.ok) {
                alert("ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã—ãŸã€‚");
                getServerStatus();
            } else {
                alert("ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            }
        } catch (error) {
            console.error(error);
            alert("ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
        }
    });


    // ãƒªã‚½ãƒ¼ã‚¹æƒ…å ±ã®æ›´æ–°
    function updateResourceMonitor(data) {
        drawChart('cpu-usage', 'CPUä½¿ç”¨ç‡', [data.cpu_usage, 100 - data.cpu_usage]);
        drawChart('memory-usage', 'ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡', [data.memory_usage, 100 - data.memory_usage]);
    }

    // ãƒãƒ£ãƒ¼ãƒˆæç”»é–¢æ•°ï¼ˆãƒ€ãƒŸãƒ¼ã€å®Ÿéš›ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
    function drawChart(elementId, title, data) {
        document.getElementById(elementId).innerHTML = `
            <h3>${title}</h3>
            <p>ä½¿ç”¨ç‡: ${data[0]}%</p>
        `;
    }

    // é›»å“ã®JavaScripté–¢æ•°
    let currentInput = '';
    let previousInput = '';
    let currentOperator = '';

    function appendToDisplay(value) {
        currentInput += value;
        document.getElementById('display').value = currentInput;
    }

    function inputDigit(digit) {
        if (currentInput === '0') {
            currentInput = digit;
        } else {
            currentInput += digit;
        }
        updateDisplay();
    }

    function inputOperator(operator) {
        if (currentOperator !== '') {
            calculate();
        }
        previousInput = currentInput;
        currentOperator = operator;
        currentInput = '';
    }

    function inputDecimal() {
        if (!currentInput.includes('.')) {
            currentInput += '.';
        }
        updateDisplay();
    }

    function clearDisplay() {
        currentInput = '';
        previousInput = '';
        currentOperator = '';
        updateDisplay();
    }

    function calculate() {
        let result;
        const prev = parseFloat(previousInput);
        const current = parseFloat(currentInput);
        if (isNaN(prev) || isNaN(current)) return;
        switch (currentOperator) {
            case '+':
                result = prev + current;
                break;
            case '-':
                result = prev - current;
                break;
            case '*':
                result = prev * current;
                break;
            case '/':
                if (current === 0) {
                    alert('0ã§å‰²ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚');
                    return;
                }
                result = prev / current;
                break;
            default:
                return;
        }
        currentInput = result.toString();
        previousInput = '';
        currentOperator = '';
        updateDisplay();
    }

    function updateDisplay() {
        document.getElementById('display').value = currentInput;
    }

    // æ™‚è¨ˆã®JavaScripté–¢æ•°
    function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
    }

    setInterval(updateClock, 1000);


    // ãƒ¡ãƒ¢å¸³ã®ä¿å­˜æ©Ÿèƒ½
    function saveNotepad() {
        const notepadContent = document.getElementById('notepad-textarea').value;
        localStorage.setItem('notepadContent', notepadContent);
        alert('ãƒ¡ãƒ¢å¸³ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚');
    }

    // ãƒ¡ãƒ¢å¸³ã®èª­ã¿è¾¼ã¿ (ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ)
    window.addEventListener('load', () => {
        const savedContent = localStorage.getItem('notepadContent');
        if (savedContent) {
            document.getElementById('notepad-textarea').value = savedContent;
        }
    });


    async function executeCommand(command) {
        const password = document.getElementById('password').value;
        const response = await fetch('/admin/command', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                password: password,
                command: command
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
               const data = await response.json();
        return data.data.status;
    }

    function displayCommandResult(event) {
        event.preventDefault();  // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€ä¿¡å‹•ä½œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«

        const commandInput = document.getElementById('command-to-execute');
        const command = commandInput.value;

        const resultDiv = document.getElementById('command-result');  // çµæœã‚’è¡¨ç¤ºã™ã‚‹divã‚’å–å¾—

        executeCommand(command)  // ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
            .then(status => {
                // çµæœã‚’è¡¨ç¤º
                if (status === 'success') {
                    resultDiv.textContent = 'ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã«æˆåŠŸã—ã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„';
                    resultDiv.style.color = 'green';
                } else {
                    resultDiv.textContent = 'ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª';
                    resultDiv.style.color = 'red';
                }
            })
            .catch(error => {
                resultDiv.textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š' + error.message;
                resultDiv.style.color = 'red';
            });

        commandInput.value = '';  // ã‚³ãƒãƒ³ãƒ‰å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
    }

    document.getElementById('execute-command-form').addEventListener('submit', displayCommandResult);



    // è¨­å®šã®ä¿å­˜
    function saveSettings() {
        localStorage.setItem('backgroundImageURL', document.getElementById('background-image-url').value);
        localStorage.setItem('autoLogin', document.getElementById('auto-login').checked ? 'true' : 'false');
        localStorage.setItem('autoResolution', document.getElementById('auto-resolution').checked ? 'true' : 'false');

        alert('è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚');
        applySettings();
    }

    // è¨­å®šã®é©ç”¨
    function applySettings() {
    // èƒŒæ™¯ç”»åƒã®é©ç”¨ (1å›ã®ã¿)
    let backgroundImageURL = localStorage.getItem('backgroundImageURL') || '';
    // URLãŒhttps://ã‹ã‚‰å§‹ã¾ã‚‹å ´åˆã®ã¿èª­ã¿è¾¼ã‚€
    if (backgroundImageURL.startsWith('https://')) {
        document.getElementById('background-image-url').value = backgroundImageURL;
        desktop.style.backgroundImage = `url(${backgroundImageURL})`;
    } else {
        desktop.style.background = 'linear-gradient(to bottom, #007bff, #663399)';
    }

    // è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³
    document.getElementById('auto-login').checked = localStorage.getItem('autoLogin') === 'true';

    // è§£åƒåº¦ã®è‡ªå‹•èª¿ç¯€
    document.getElementById('auto-resolution').checked = localStorage.getItem('autoResolution') === 'true';
    if (localStorage.getItem('autoResolution') === 'true') {
        window.onresize = function () {
            const windowWidth = window.innerWidth;
            const maxWindowWidth = 800;
            const minWindowWidth = 400;
            let newWindowWidth = windowWidth;

            if (windowWidth > maxWindowWidth) {
                newWindowWidth = maxWindowWidth;
            } else if (windowWidth < minWindowWidth) {
                newWindowWidth = minWindowWidth;
            }

            // å„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å¹…ã‚’èª¿æ•´
            const windows = document.querySelectorAll('.window');
            windows.forEach(window => {
                window.style.width = newWindowWidth + 'px';
            });
        }
        // åˆæœŸã‚µã‚¤ã‚ºè¨­å®š
        window.onresize();
    } else {
        window.onresize = null;
    }
}


    function loadSettings() {
    // èƒŒæ™¯ç”»åƒURLã®èª­ã¿è¾¼ã¿
    let backgroundImageURL = localStorage.getItem('backgroundImageURL') || '';
    // URLãŒhttps://ã‹ã‚‰å§‹ã¾ã‚‹å ´åˆã®ã¿èª­ã¿è¾¼ã‚€
    if (backgroundImageURL.startsWith('https://')) {
        document.getElementById('background-image-url').value = backgroundImageURL;
    }

    // è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³è¨­å®šã®èª­ã¿è¾¼ã¿
    document.getElementById('auto-login').checked = localStorage.getItem('autoLogin') === 'true';

    // è§£åƒåº¦è‡ªå‹•èª¿ç¯€è¨­å®šã®èª­ã¿è¾¼ã¿
    document.getElementById('auto-resolution').checked = localStorage.getItem('autoResolution') === 'true';

    applySettings(); // è¨­å®šã‚’é©ç”¨
}


    // ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã«æ™‚é–“ã¨æ—¥ä»˜ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function updateTaskbarDatetime() {
        const now = new Date();
        const options = {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: 'numeric',
            second: 'numeric'
        };
        const formattedDate = now.toLocaleDateString('ja-JP', options); // æ—¥æœ¬èªè¡¨è¨˜ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        document.getElementById('taskbar-datetime').textContent = formattedDate;
    }

    // 1ç§’ã”ã¨ã«æ›´æ–°
    setInterval(updateTaskbarDatetime, 1000);

</script>

</body>
</html>
