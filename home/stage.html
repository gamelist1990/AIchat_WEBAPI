<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <style></style>
    <style>
        /* å…¨ä½“çš„ãªã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: 'Consolas', monospace;
            background-color: #eee;
            margin: 0;
            padding: 0;
            color: #222;
            overflow: hidden;
        }

        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— */
        #desktop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%; 
    padding-bottom: 40px; 
            background: #007bff;
            background: -webkit-linear-gradient(to bottom, #007bff, #663399);
            background: linear-gradient(to bottom, #007bff, #663399); 
            overflow: hidden;
        }

        /* ã‚¿ã‚¹ã‚¯ãƒãƒ¼ */
        #taskbar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background-color: #ccc;
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 2;
            display: none; 
            bottom: 0; 
        }
        #taskbar .icon {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 20px;
        }

        /* ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .window {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: absolute;
            min-width: 300px;
            min-height: 200px;
            resize: both;
            overflow-y: hidden; 
            z-index: 1;
        }

        /* ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ */
        .window-titlebar {
            background-color: #2196F3;
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            cursor: move; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .window-titlebar h2 {
            margin: 0;
            font-size: 14px; 
        }
        .window-titlebar .controls button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-left: 8px;
        }

        /* ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .window-content {
            padding: 10px;
            height: calc(100% - 36px);
            overflow-y: auto;
        }

        /* ã‚¿ãƒ– */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 8px 12px;
            transition: background-color 0.3s;
            font-size: 13px;
        }
        .tab button:hover {
            background-color: #ddd;
        }
        .tab button.active {
            background-color: #ccc;
        }
        .tabcontent {
            display: none;
            padding: 10px;
            border: 1px solid #ccc;
            border-top: none;
        }
        .tablinks {
    overflow-y: auto; 
    -ms-overflow-style: none; 
    scrollbar-width: none; 
}

.tablinks::-webkit-scrollbar { 
    display: none;
}

        /* ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ› */
        #console-output {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 8px;
            background-color: #000;
            color: #fff;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            text-align: left;
            padding: 6px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ  */
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"],
        input[type="password"],
        textarea {
            width: calc(100% - 12px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        /* ãƒœã‚¿ãƒ³ */
        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #45a049;
        }
        .close-button {
            background-color: #f44336;
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }
        .close-button:hover {
            background-color: #d32f2f;
        }

        /* ãƒªã‚¹ãƒˆ */
        ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        li {
            margin-bottom: 5px;
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .error {
            color: red;
            margin-bottom: 10px;
        }

        /* ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  */
        #login-form {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        /* èƒŒæ™¯ã‚’æš—ãã™ã‚‹ */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; 
            z-index: 5; 
        }
        /* iframeã®ã‚¹ã‚¿ã‚¤ãƒ« */
        iframe {
            width: 100%;
            height: calc(100% - 36px);
            border: none;
        }
        

/* é›»å“ã‚¢ãƒ—ãƒªã®ã‚¹ã‚¿ã‚¤ãƒ« */
#calculator-window {
  width: 240px; /* æ¨ªå¹…ã‚’ç¸®å° */
  height: 300px; /* é«˜ã•ã‚’ç¸®å° */
}

#calculator input[type="button"] {
  width: 40px;  /* ãƒœã‚¿ãƒ³ã®æ¨ªå¹…ã‚’ç¸®å° */
  height: 40px;  /* ãƒœã‚¿ãƒ³ã®é«˜ã•ã‚’ç¸®å° */
  margin: 4px;  /* ãƒãƒ¼ã‚¸ãƒ³ã‚’ç¸®å° */
  font-size: 16px; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ç¸®å° */
}

#calculator #display {
  width: calc(100% - 18px); /* è¡¨ç¤ºé ˜åŸŸã®å¹…ã‚’èª¿æ•´ */
  height: 30px;  /* è¡¨ç¤ºé ˜åŸŸã®é«˜ã•ã‚’ç¸®å° */
  margin: 4px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’ç¸®å° */
  font-size: 18px; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ç¸®å° */
}

/* æ™‚è¨ˆã‚¢ãƒ—ãƒªã®ã‚¹ã‚¿ã‚¤ãƒ« */
#clock-window {
  width: 300px;
  height: 100px;
}

#clock {
  width: 100%;
  height: 100%;
  font-size: 36px;
  text-align: center;
  line-height: 80px; /* æ™‚è¨ˆã®æ–‡å­—ã‚’ä¸­å¤®ã«é…ç½® */
}
@media (max-width: 768px) {
  .window {
    min-width: 90%; /* ç”»é¢å¹…ã®90%ã« */
    min-height: 60%; /* ç”»é¢é«˜ã•ã®60%ã« */
    top: 10%; /* ä¸Šã‹ã‚‰ã®ä½ç½®ã‚’èª¿æ•´ */
    left: 5%; /* å·¦ã‹ã‚‰ã®ä½ç½®ã‚’èª¿æ•´ */
  }

  #taskbar {
    height: 60px; /* ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®é«˜ã•ã‚’å¤§ãã */
  }

  #taskbar .icon {
    width: 40px; /* ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºã‚’å¤§ãã */
    height: 40px; 
    font-size: 24px;
  }

 
}
    </style>
</head>
<body>
    <div id="taskbar">
        <div class="icon" onclick="openWindow('server-management')">âš™ï¸</div>
        <div class="icon" onclick="openWindow('web-browser-window')">ğŸŒ</div>
        <div class="icon" onclick="openWindow('notepad-window')">ğŸ“</div>
        <div class="icon" onclick="openWindow('resource-monitor-window')">ğŸ“Š</div>
        <div class="icon" onclick="openWindow('calculator-window')">ğŸ§®</div>
        <div class="icon" onclick="openWindow('clock-window')">â±ï¸</div>        
    </div>

    <div id="desktop">
        <div id="overlay"></div>

        <div id="login-form">
            <h2>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h2>
            <form id="login-form-form">
                <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
                <input type="password" id="password" name="password" required autocomplete="new-password">
                <button class="button" type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div id="error-message" class="error"></div>
            </form>
        </div>

        <div id="server-management" class="window" style="display: none; width: 800px; height: 600px; top: 100px; left: 100px;">
            <div class="window-titlebar">
                <h2>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('server-management')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="tab">
                    <button class="tablinks" onclick="openTab(event, 'server-status')">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</button>
                    <button class="tablinks" onclick="openTab(event, 'processes')">ãƒ—ãƒ­ã‚»ã‚¹</button>
                    <button class="tablinks" onclick="openTab(event, 'console')">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</button>
                    <button class="tablinks" onclick="openTab(event, 'ban-management')">BANç®¡ç†</button>
                    <button class="tablinks" onclick="openTab(event, 'file-management')">ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</button>
                </div>

                <div id="server-status" class="tabcontent">
                    <h3>ã‚µãƒ¼ãƒãƒ¼æƒ…å ±</h3>
                    <div id="server-status-content"></div>
                    <form id="stop-server-form">
                        <button class="button" type="submit">ã‚µãƒ¼ãƒãƒ¼åœæ­¢</button>
                    </form>
                    <br>
                    <form id="start-server-form">
                        <button class="button" type="submit">ã‚µãƒ¼ãƒãƒ¼èµ·å‹•</button>
                    </form>
                </div>

                <div id="processes" class="tabcontent">
                    <h3>å®Ÿè¡Œä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹</h3>
                    <pre id="processes-list"></pre>
                </div>

                <div id="console" class="tabcontent">
                    <h3>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</h3>
                    <pre id="console-output"></pre>
                </div>

                <div id="ban-management" class="tabcontent">
                    <h3>BANç®¡ç†</h3>
                    <p>ç¾åœ¨ã®BANäººæ•°: <span id="banned-count">0</span></p>
                    <table id="ban-history">
                        <thead>
                        <tr>
                            <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</th>
                            <th>BANæ™‚é–“</th>
                            <th>è§£é™¤</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <form id="unban-form">
                        <label for="user-id">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</label>
                        <input type="text" id="user-id" name="user-id" required>
                        <button class="button" type="submit">BANè§£é™¤</button>
                    </form>
                </div>

                <div id="file-management" class="tabcontent">
                    <h3>ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</h3>
                    <div class="management-section">
                        <form id="rename-form">
                            <label for="old-name">æ—§ãƒ•ã‚¡ã‚¤ãƒ«å:</label>
                            <input type="text" id="old-name" name="old-name" required>
                            <label for="new-name">æ–°ãƒ•ã‚¡ã‚¤ãƒ«å:</label>
                            <input type="text" id="new-name" name="new-name" required>
                            <button class="button" type="submit">åå‰å¤‰æ›´</button>
                        </form>
                        <div id="rename-result"></div>
                    </div>
                    <div class="management-section">
                        <form id="show-form">
                            <label for="show-file">ãƒ•ã‚¡ã‚¤ãƒ«å(æ‹¡å¼µå­å«ã‚€):</label>
                            <input type="text" id="show-file" name="file_name" required>
                            <button class="button" type="submit">è¡¨ç¤º</button>
                        </form>
                        <pre id="show-result" style="height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-top: 10px;"></pre>
                    </div>
                    <div class="management-section">
                        <form id="update-json-form">
                            <label for="json-file-path">ãƒ•ã‚¡ã‚¤ãƒ«å(æ‹¡å¼µå­å«ã‚€):</label>
                            <input type="text" id="json-file-path" name="file_path" required>
                            <label for="json-data">ãƒ‡ãƒ¼ã‚¿:</label>
                            <textarea id="json-data" name="data" rows="5" required></textarea>
                            <button class="button" type="submit">ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>
                        </form>
                        <br>
                        <div id="update-json-result"></div>
                    </div>
                    <div class="management-section">
                        <form id="execute-command-form">
                            <label for="command-to-execute">ã‚³ãƒãƒ³ãƒ‰:</label>
                            <input type="text" id="command-to-execute" name="command_to_execute" required>
                            <button class="button" type="submit">å®Ÿè¡Œ</button>
                        </form>
                        <div id="command-result"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="web-browser-window" class="window" style="display: none; width: 800px; height: 600px; top: 150px; left: 150px;">
            <div class="window-titlebar">
                <h2>Webãƒ–ãƒ©ã‚¦ã‚¶</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('web-browser-window')">X</button>
                </div>
            </div>
            <div class="window-content">
                <iframe id="web-browser-iframe" src="https://gamelist1990.github.io/gamelist1990/page/"></iframe>
            </div>
        </div>

        

        <div id="resource-monitor-window" class="window" style="display: none; width: 400px; height: 300px; top: 250px; left: 250px;">
            <div class="window-titlebar">
                <h2>ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒ¼</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('resource-monitor-window')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div id="cpu-usage" style="width: 100%; height: 100px; margin-bottom: 20px;"></div>
                <div id="memory-usage" style="width: 100%; height: 100px;"></div>
            </div>
        </div>
    </div>

    <div id="calculator-window" class="window" style="display: none; width: 300px; height: 400px; top: 100px; left: 100px;">
            <div class="window-titlebar">
                <h2>é›»å“</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('calculator-window')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div id="calculator">
                    <input type="text" id="display" readonly>
                    <input type="button" value="7" onclick="inputDigit('7')"> 
                    <input type="button" value="8" onclick="inputDigit('8')"> 
                    <input type="button" value="9" onclick="inputDigit('9')"> 
                    <input type="button" value="/" onclick="inputOperator('/')"> 
                    <br>
                    <input type="button" value="4" onclick="inputDigit('4')"> 
                    <input type="button" value="5" onclick="inputDigit('5')"> 
                    <input type="button" value="6" onclick="inputDigit('6')"> 
                    <input type="button" value="*" onclick="inputOperator('*')"> 
                    <br>
                    <input type="button" value="1" onclick="inputDigit('1')"> 
                    <input type="button" value="2" onclick="inputDigit('2')"> 
                    <input type="button" value="3" onclick="inputDigit('3')"> 
                    <input type="button" value="-" onclick="inputOperator('-')"> 
                    <br>
                    <input type="button" value="0" onclick="inputDigit('0')"> 
                    <input type="button" value="." onclick="inputDecimal('.')"> 
                    <input type="button" value="C" onclick="clearDisplay()"> 
                    <input type="button" value="+" onclick="inputOperator('+')"> 
                    <br>
                    <input type="button" value="=" onclick="calculate()" style="width: 210px;"> 
                </div>
            </div>
        </div>

        <div id="clock-window" class="window" style="display: none; width: 300px; height: 100px; top: 200px; left: 200px;">
            <div class="window-titlebar">
                <h2>æ™‚è¨ˆ</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('clock-window')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div id="clock"></div>
            </div>
        </div>
     <div id="notepad-window" class="window" style="display: none; width: 600px; height: 400px; top: 200px; left: 200px;">
            <div class="window-titlebar">
                <h2>ãƒ¡ãƒ¢å¸³</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('notepad-window')">X</button>
                </div>
            </div>
            <div class="window-content" style="padding-bottom: 40px;"> <textarea id="notepad-textarea" style="width: 100%; height: calc(100% - 35px);"></textarea>
                <br>
                <button class="button" onclick="saveNotepad()" style="position: absolute; bottom: 10px; left: 10px;">ä¿å­˜</button> </div>
        </div>
        </div>
   </div>


 









<!-- JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('login-form-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            await login();
        });

         dragElement(document.getElementById("server-management"));
            dragElement(document.getElementById("web-browser-window"));
            dragElement(document.getElementById("notepad-window"));
            dragElement(document.getElementById("resource-monitor-window")); // ãƒªã‚½ãƒ¼ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¿½åŠ 
            dragElement(document.getElementById("calculator-window")); 
            dragElement(document.getElementById("clock-window"));

            // æœ€åˆã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¿ãƒ–ã‚’é–‹ã
           document.querySelector('#server-management .tab button:first-child').click();
    });

    let ws; // WebSocket ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
async function login() {
    const password = document.getElementById('password').value;

    try {
        const response = await fetch('/antibot', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `password=${password}`
        });

        if (response.ok) {
            // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('server-management').style.display = 'block';
            document.getElementById('taskbar').style.display = 'flex';

            // WebSocket æ¥ç¶šã‚’é–‹å§‹
            ws = new WebSocket('ws://' + window.location.host + '/ws'); // ãƒ›ã‚¹ãƒˆåã¨ãƒãƒ¼ãƒˆã‚’è‡ªå‹•å–å¾—

            ws.onopen = () => {
                console.log("WebSocket connection established");
                getServerStatus();
                getProcesses();
                getConsoleLog();
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);

                if (data.type === "server_status") {
                    updateServerStatus(data.data);
                } else if (data.type === "processes") {
                    updateProcesses(data.data);
                } else if (data.type === "console_log") {
                    const consoleOutput = document.getElementById('console-output');
                    const logMessage = document.createElement('p');
                    logMessage.textContent = data.data;
                    consoleOutput.appendChild(logMessage);
                    updateConsoleLog(data.data);
                } else if (data.type === "command_result") {
                    document.getElementById('command-result').textContent = data.data.message;
                }  else if (data.type === "resources") {
      updateResourceMonitor(data.data);
  
                    
                }
            };

        } else {
            document.getElementById('error-message').textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚';
        }
    } catch (error) {
        console.error(error);
        document.getElementById('error-message').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
    }
}

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•å¯èƒ½ã«ã™ã‚‹é–¢æ•°
function dragElement(elmnt) {
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    let isDragging = false; // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã‹ã©ã†ã‹ã‚’ç¤ºã™ãƒ•ãƒ©ã‚°

    // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸¡æ–¹ã«å¯¾å¿œ
    elmnt.querySelector('.window-titlebar').addEventListener('mousedown', dragMouseDown);
    elmnt.querySelector('.window-titlebar').addEventListener('touchstart', dragMouseDown);

    function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();

        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€æœ€åˆã®ã‚¿ãƒƒãƒãƒã‚¤ãƒ³ãƒˆã®åº§æ¨™ã‚’å–å¾—
        if (e.type === 'touchstart') {
            pos3 = e.touches[0].clientX;
            pos4 = e.touches[0].clientY;
        } else {
            // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€é€šå¸¸ã®åº§æ¨™ã‚’å–å¾—
            pos3 = e.clientX;
            pos4 = e.clientY;
        }

        isDragging = true; // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹

        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸¡æ–¹ã«å¯¾å¿œ
        document.addEventListener('mouseup', closeDragElement);
        document.addEventListener('touchend', closeDragElement);
        document.addEventListener('mousemove', elementDrag);
        document.addEventListener('touchmove', elementDrag);
    }

    function elementDrag(e) {
        if (!isDragging) return; // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã§ãªã„å ´åˆã¯å‡¦ç†ã—ãªã„

        e = e || window.event;
        e.preventDefault();

        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€æœ€åˆã®ã‚¿ãƒƒãƒãƒã‚¤ãƒ³ãƒˆã®åº§æ¨™ã‚’å–å¾—
        if (e.type === 'touchmove') {
            pos1 = pos3 - e.touches[0].clientX;
            pos2 = pos4 - e.touches[0].clientY;
            pos3 = e.touches[0].clientX;
            pos4 = e.touches[0].clientY;
        } else {
            // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã€é€šå¸¸ã®åº§æ¨™ã‚’å–å¾—
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;
        }

        // è¦ç´ ã®ä½ç½®ã‚’æ›´æ–°
        elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
        elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
    }

    function closeDragElement() {
        isDragging = false; // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
        document.removeEventListener('mouseup', closeDragElement);
        document.removeEventListener('touchend', closeDragElement);
        document.removeEventListener('mousemove', elementDrag);
        document.removeEventListener('touchmove', elementDrag);
    }
}


        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãé–¢æ•°
// ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãé–¢æ•°
function openWindow(windowId) {
    const appWindow = document.getElementById(windowId); // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®è¦ç´ 
    appWindow.style.display = 'block';

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®åˆæœŸã‚µã‚¤ã‚ºã‚’ç”»é¢ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦èª¿æ•´
    const screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    const screenHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å¹…ã‚’ç”»é¢å¹…ã®80%ã€é«˜ã•ã‚’ç”»é¢é«˜ã•ã®60%ã«è¨­å®š (å¿…è¦ã«å¿œã˜ã¦èª¿æ•´)
    appWindow.style.width = Math.floor(screenWidth * 0.8) + 'px';
    appWindow.style.height = Math.floor(screenHeight * 0.6) + 'px';

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ä½ç½®ã‚’ç”»é¢ä¸­å¤®ã«è¨­å®š
    appWindow.style.top = Math.floor((screenHeight - appWindow.offsetHeight) / 2) + 'px';
    appWindow.style.left = Math.floor((screenWidth - appWindow.offsetWidth) / 2) + 'px';
}

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹é–¢æ•°
    function closeWindow(windowId) {
        document.getElementById(windowId).style.display = 'none';
        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¡¨ç¤º
       // document.getElementById('login-form').style.display = 'block';
       // document.getElementById('overlay').style.display = 'block';
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }

    // ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã®å–å¾—
            function getServerStatus() {
                ws.send(JSON.stringify({ command: "get_server_status" }));
            }

            // ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã®å–å¾—
            function getProcesses() {
                ws.send(JSON.stringify({ command: "get_processes" }));
            }

            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®å–å¾—
            function getConsoleLog() {
                ws.send(JSON.stringify({ command: "get_console_log" }));
            }

            // ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã®æ›´æ–°
            function updateServerStatus(data) {
                let statusHTML = '';
                for (const [key, value] of Object.entries(data)) {
                    if (key === "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±") {
                        let displayValue = JSON.stringify(value, null, 2); // æ•´å½¢ã—ã¦è¡¨ç¤º
                        statusHTML += `<p><strong>${key}:</strong></p><pre>${displayValue}</pre>`;
                    } else {
                        statusHTML += `<p><strong>${key}:</strong> ${value}</p>`;
                    }
                }
                document.getElementById('server-status-content').innerHTML = statusHTML;
            }

            // ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã®æ›´æ–°
            function updateProcesses(data) {
                document.getElementById('processes-list').textContent = data.processes;
            }

            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®æ›´æ–°
            function updateConsoleLog(data) {
                document.getElementById('console-output').textContent = data.console_log.join('');
            }

    // BANå±¥æ­´ã®æ›´æ–°
    async function updateBanHistory() {
        try {
            const response = await fetch('/antibot/history');
            const data = await response.json();

            document.getElementById('banned-count').textContent = data.bannedCount;
            const banHistoryTable = document.getElementById('ban-history').querySelector('tbody');
            banHistoryTable.innerHTML = ''; // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¯ãƒªã‚¢

            data.banHistory.forEach(ban => {
                const row = banHistoryTable.insertRow();
                row.insertCell().textContent = ban.user_id;
                row.insertCell().textContent = ban.ban_time;

                const unbanButton = document.createElement('button');
                unbanButton.textContent = 'è§£é™¤';
                unbanButton.classList.add('button');
                unbanButton.addEventListener('click', () => {
                    unbanUser(ban.user_id);
                });
                row.insertCell().appendChild(unbanButton);
            });
        } catch (error) {
            console.error(error);
        }
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®BANè§£é™¤
    async function unbanUser(userId) {
        try {
            const response = await fetch('/antibot/unban', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ user_id: userId })
            });

            if (response.ok) {
                updateBanHistory();
            } else {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®BANè§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        } catch (error) {
            console.error(error);
        }
    }

    // ã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•
    async function restartServer() {
        try {
            const response = await fetch('/admin/restart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: document.getElementById('password').value })
            });

            if (response.ok) {
                console.log('ã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚');
            } else {
                console.error('ã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        } catch (error) {
            console.error(error);
        }
    }

    // ã‚µãƒ¼ãƒãƒ¼ã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³
    async function shutdownServer() {
        if (!confirm('æœ¬å½“ã«ã‚µãƒ¼ãƒãƒ¼ã‚’ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã—ã¾ã™ã‹ï¼Ÿ')) return;
        try {
            const response = await fetch('/admin/shutdown', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: document.getElementById('password').value })
            });

            if (response.ok) {
                console.log('ã‚µãƒ¼ãƒãƒ¼ã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚');
            } else {
                console.error('ã‚µãƒ¼ãƒãƒ¼ã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        } catch (error) {
            console.error(error);
        }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ã®åå‰å¤‰æ›´
    document.getElementById('rename-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        const oldName = document.getElementById('old-name').value;
        const newName = document.getElementById('new-name').value;

        try {
            const response = await fetch('/admin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ rename: { old_name: oldName, new_name: newName }, password: document.getElementById('password').value })
            });

            if (response.ok) {
                const data = await response.json();
                document.getElementById('rename-result').textContent = data.message;
            } else {
                document.getElementById('rename-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
            }
        } catch (error) {
            console.error(error);
            document.getElementById('rename-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡¨ç¤º
document.getElementById('show-form').addEventListener('submit', async (event) => {
    event.preventDefault();
    const showFilename = document.getElementById('show-file').value;
    const password = document.getElementById('password').value;

    try {
        const response = await fetch('/admin/showfile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ file_name: showFilename, password: password })
        });

        if (response.ok) {
            const fileContent = await response.text();
            const formattedContent = fileContent.replace(/\n/g, '<br>'); // æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ <br> ã‚¿ã‚°ã«å¤‰æ›
            document.getElementById('show-result').innerHTML = formattedContent; // innerHTML ã‚’ä½¿ç”¨ã—ã¦ HTML ã¨ã—ã¦è¨­å®š
        } else {
            const errorData = await response.json();
            document.getElementById('show-result').textContent = errorData.error;
        }

    } catch (error) {
        console.error(error);
        document.getElementById('show-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
    }
});

    // BANè§£é™¤ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
    document.getElementById('unban-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        const userId = document.getElementById('user-id').value;
        await unbanUser(userId);
    });

    // JSONæ›´æ–°ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
document.getElementById('update-json-form').addEventListener('submit', async (event) => {
    event.preventDefault();

    const filePath = document.getElementById('json-file-path').value;
    const jsonData = document.getElementById('json-data').value;
    const password = document.getElementById('password').value;

    try {
        const response = await fetch('/admin/update_json', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                password: password,
                file_path: filePath, // file_path ã‚’è¿½åŠ 
                data: JSON.parse(jsonData) // data ã‚’è¿½åŠ 
            })
        });

        if (response.ok) {
            const data = await response.json();
            document.getElementById('update-json-result').textContent = data.message;
        } else {
            document.getElementById('update-json-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }
    } catch (error) {
        console.error(error);
        document.getElementById('update-json-result').textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
    }
});

    function openWebBrowser(url) {
            const webBrowserWindow = document.getElementById('web-browser-window');
            const webBrowserIframe = document.getElementById('web-browser-iframe');
            webBrowserIframe.src = url; // iframe ã® src å±æ€§ã‚’è¨­å®š
            webBrowserWindow.style.display = 'block';
        }

    // ã‚µãƒ¼ãƒãƒ¼åœæ­¢
            document.getElementById('stop-server-form').addEventListener('submit', async (event) => {
                event.preventDefault();
                try {
                    const response = await fetch('/admin/update_server_status', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: `status=stop&password=${document.getElementById('password').value}`
                    });
                    if (response.ok) {
                        alert("ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã—ã¾ã—ãŸã€‚");
                        getServerStatus(); // WebSocket ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±ã‚’æ›´æ–°
                    } else {
                        alert("ã‚µãƒ¼ãƒãƒ¼ã®åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                    }
                } catch (error) {
                    console.error(error);
                    alert("ã‚µãƒ¼ãƒãƒ¼ã®åœæ­¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
                }
            });

            // ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
            document.getElementById('start-server-form').addEventListener('submit', async (event) => {
                event.preventDefault();
                try {
                    const response = await fetch('/admin/update_server_status', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: `status=start&password=${document.getElementById('password').value}`
                    });
                    if (response.ok) {
                        alert("ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã—ãŸã€‚");
                        getServerStatus(); // WebSocket ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±ã‚’æ›´æ–°
                    } else {
                        alert("ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                    }
                } catch (error) {
                    console.error(error);
                    alert("ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
                }
            });

    function getResources() {
    ws.send(JSON.stringify({ command: "get_resources" }));
}

// ãƒªã‚½ãƒ¼ã‚¹æƒ…å ±ã®æ›´æ–°
function updateResourceMonitor(data) {
  // ã“ã“ã«ãƒãƒ£ãƒ¼ãƒˆæç”»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç”¨ã„ãŸå‡¦ç†ã‚’è¿½åŠ 
  // ä¾‹ï¼šCPUä½¿ç”¨ç‡ã‚’å††ã‚°ãƒ©ãƒ•ã§è¡¨ç¤º
  drawChart('cpu-usage', 'CPUä½¿ç”¨ç‡', [data.cpu_usage, 100 - data.cpu_usage]);
  // ä¾‹ï¼šãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã‚’ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã§è¡¨ç¤º
  drawChart('memory-usage', 'ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡', [data.memory_usage, 100 - data.memory_usage]);
}
setInterval(getResources, 2000);

// ãƒãƒ£ãƒ¼ãƒˆæç”»é–¢æ•°ï¼ˆãƒ€ãƒŸãƒ¼ã€å®Ÿéš›ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
function drawChart(elementId, title, data) {
    document.getElementById(elementId).innerHTML = `
        <h3>${title}</h3>
        <p>ä½¿ç”¨ç‡: ${data[0]}%</p>
    `;
}

  // é›»å“ã®JavaScripté–¢æ•°
let currentInput = '';
let previousInput = '';
let currentOperator = '';

function appendToDisplay(value) {
    currentInput += value;
    document.getElementById('display').value = currentInput;
}

function inputDigit(digit) {
    if (currentInput === '0') {
        currentInput = digit;
    } else {
        currentInput += digit;
    }
    updateDisplay();
}

function inputOperator(operator) {
    if (currentOperator !== '') {
        calculate();
    }
    previousInput = currentInput;
    currentOperator = operator;
    currentInput = '';
}

function inputDecimal() {
    if (!currentInput.includes('.')) {
        currentInput += '.';
    }
    updateDisplay();
}

function clearDisplay() {
    currentInput = '';
    previousInput = '';
    currentOperator = '';
    updateDisplay();
}

function calculate() {
    let result;
    const prev = parseFloat(previousInput);
    const current = parseFloat(currentInput);
    if (isNaN(prev) || isNaN(current)) return;
    switch (currentOperator) {
        case '+':
            result = prev + current;
            break;
        case '-':
            result = prev - current;
            break;
        case '*':
            result = prev * current;
            break;
        case '/':
            if (current === 0) {
                alert('0ã§å‰²ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚');
                return;
            }
            result = prev / current;
            break;
        default:
            return;
    }
    currentInput = result.toString();
    previousInput = '';
    currentOperator = '';
    updateDisplay();
}

function updateDisplay() {
    document.getElementById('display').value = currentInput;
}

// æ™‚è¨ˆã®JavaScripté–¢æ•°
function updateClock() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
}
setInterval(updateClock, 1000);


// ãƒ¡ãƒ¢å¸³ã®ä¿å­˜æ©Ÿèƒ½
function saveNotepad() {
    const notepadContent = document.getElementById('notepad-textarea').value;
    localStorage.setItem('notepadContent', notepadContent);
    alert('ãƒ¡ãƒ¢å¸³ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚');
}

// ãƒ¡ãƒ¢å¸³ã®èª­ã¿è¾¼ã¿ (ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ)
window.addEventListener('load', () => {
    const savedContent = localStorage.getItem('notepadContent');
    if (savedContent) {
        document.getElementById('notepad-textarea').value = savedContent;
    }
});


 
</script>

</body>
</html>